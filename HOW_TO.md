# HOW-TO: 学習データ生成ガイド

このガイドは、`sdg`を初めて利用する方向けに、学習データを生成する基本的な手順と設定のカスタマイズ方法を解説します。

## 1. 基本的な使い方

データ生成は、以下のコマンドを実行するだけで開始できます。

```bash
python main.py --config settings.yaml
```

*   `--config`: 使用する設定ファイルを指定します。デフォルトは `settings.yaml` です。
    *   NVIDIA GPUがない環境や、手軽に試したい場合は `settings_ollama.yaml` を利用できます。
        ```bash
        python main.py --config settings_ollama.yaml
        ```

処理が完了すると、`output/final_dataset.jsonl` というファイルに学習データが保存されます。

## 2. 設定ファイル (`settings.yaml`) の役割

`settings.yaml`（または `settings_ollama.yaml`）は、データ生成の全プロセスを制御する「**設計図**」や「**指示書**」のようなものです。このファイルの中身を書き換えることで、生成されるデータの内容や品質を細かく調整できます。

### 推論バックエンドの選択

まず、お使いの環境に合わせてどちらの「頭脳（推論バックエンド）」を使うか決めます。

| バックエンド | `inference_backend`の値 | こんな人向け |
| :--- | :--- | :--- |
| **vLLM** | `vllm` | NVIDIA製の高性能なグラフィックボード（GPU）を持っている。大量のデータを高速に作りたい。 |
| **Ollama** | `ollama` | GPUがない、またはNVIDIA製ではない。まずは手軽に試してみたい。 |

`settings.yaml`はvLLM用、`settings_ollama.yaml`はOllama用に初期設定されています。

## 3. 主要な設定項目を理解する

`settings.yaml`の中には多くの設定項目がありますが、特に重要なものをいくつか紹介します。`True`（有効）と`False`（無効）を切り替えるだけでも、結果は大きく変わります。

| 設定項目 | 何をするか？ | おすすめの使い分け |
| :--- | :--- | :--- |
| `Seed_generation_method` | 最初の「質問」の作り方を決めます。<br>• `'base'`: ふわっとした指示で自由に作らせる。<br>• `'inst'`: ある程度整った形式で作らせる。 | • `'base'`: 予想外の多様な質問が欲しい時。<br>• `'inst'`: 品質の安定した質問が欲しい時。 |
| `Prompt_evolution` | AIに「質問」を自己改善（進化）させるかどうか。 | • `True`: より複雑で洗練された質問が欲しい時。<br>• `False`: シンプルな質問のままで良い時。 |
| `Answer_evolution` | AIに「回答」を自己改善（進化）させるかどうか。 | • `True`: 回答の質をさらに高めたい時。<br>• `False`: 最初の回答のままで良い時。 |
| `Data_retention_rate_after_diversity_cut` | 似たような質問をどのくらい削るかの割合（%）。 | • `50`: 半分削って多様性を重視。<br>• `100`: 全て残して量を重視。 |
| `Data_curation` | 最後に、AIが生成した「質問と回答のペア」が適切か、もう一度チェックさせるか。 | • `True`: 最終的な品質を厳しくチェックしたい時。<br>• `False`: チェックせずに全ての結果を採用する時。 |
| `Using_think_models_for_answer` | 回答を生成する際に、まず「思考プロセス」を生成させてから回答を作るか。 | • `True`: より論理的で丁寧な回答が欲しい時。<br>• `False`: シンプルな回答で良い時。 |

## 4. プロンプトをカスタマイズする

`prompts/` ディレクトリには、AIに指示を出すための「**プロンプト**（命令文）」のテンプレートが保存されています。これらのファイルを編集することで、AIの振る舞いをより細かく制御できます。

| プロンプトファイル | パイプラインのどの段階で使われるか？ | 編集するとどうなるか？ |
| :--- | :--- | :--- |
| `inst_seed.txt` | **質問生成** (`Seed_generation_method: 'inst'`) | 最初の質問のスタイルやテーマを具体的に指示できます。「〇〇についての質問を作って」など。 |
| `bare.txt` | **質問生成** (`Seed_generation_method: 'base'`) | 自由な発想で質問を作らせる際の、非常に基本的な指示です。 |
| `evo_question_prompt.txt` | **質問進化** (`Prompt_evolution: True`) | 質問をどのように「進化」させるかを指示できます。「もっと専門的に」「もっと分かりやすく」など。 |
| `evo_answer_prompt.txt` | **回答進化** (`Answer_evolution: True`) | 回答をどのように「進化」させるかを指示できます。「具体例を加えて」「もっと簡潔に」など。 |
| `curation.txt` | **最終キュレーション** (`Data_curation: True`) | 最終チェックの際の判断基準を指示できます。「事実に基づいているか？」「誤字はないか？」など。 |

### カスタマイズの例

例えば、「**小学生にも分かるような、科学に関する簡単なQ&Aデータセット**」を作りたい場合、以下のように調整してみましょう。

1.  **`settings.yaml`の編集:**
    *   `Prompt_evolution`: `True` にして、質問をより平易にする。
    *   `Answer_evolution`: `True` にして、回答をより分かりやすくする。
2.  **`prompts/inst_seed.txt`の編集:**
    *   「科学に関する、小学生向けの簡単な質問を1つだけ生成してください。」のように書き換える。
3.  **`prompts/evo_question_prompt.txt`の編集:**
    *   「この質問を、もっと簡単な言葉を使って、小学生が興味を持つような表現に書き換えてください。」のようにする。
4.  **`prompts/evo_answer_prompt.txt`の編集:**
    *   「この回答を、専門用語を使わずに、たとえ話を交えながら小学生にも分かるように書き直してください。」のようにする。

このように、設定ファイルとプロンプトを組み合わせることで、目的に合わせた多様な学習データを生成することが可能です。
